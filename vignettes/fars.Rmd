---
title: "FARS"
author: "Jay Brown"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo=FALSE, warning=FALSE}
suppressMessages(library(dplyr))
suppressMessages(library(maps))
source("../R/fars_functions.R")
suppressMessages(library(knitr))
opts_knit$set(root.dir = "data/")

```

The Fatality Analysis Reporting System (FARS) is a database of car accidents where at least one person has died within 30 days of an accident taking place on a public road in the US. The data is used extensively to study traffic fatalities since 1975. 

The FARS data sample provides details of accidents from 2013 to 2015. This vignette reviews the functions available in this package.

## Dependencies

The FARS package depends on several standard R packages you may already have installed.

* dplyr
* tidyr
* readr 
* maps 


## Using the FARS Package

Use the FARS data package to explore incidents of traffic fatalities.

The public functions provide access to the data.

* fars_summarize_years 
* fars_map_state

### fars_summarize_years

The function fars_summarize_years reads available FARS data and will sumarize it to provide a count of the number of fatal accidents per month in all states.

The function takes a vector of years and reads data from derived filenames then summarizes the number of observations for each year grouped by month. It transforms the data to wide format and returns this as a data frame.

param years A vector of years.

@return A wide dataframe of the number of observations by month and year.
 
@importFrom dplyr bind_rows, group_by, summarize
@importFrom tidyr spread 

#### Examples

```{r echo = TRUE}

fars_summarize_years(2013:2015)

```

### fars_map_state

The function fars_map_state takes the supplied state number and year and plots the locations of accidents on a map of the specified state.

Note the maps library must be loaded in the session else it may fail.

If an invalid state number is supplied it will error saying "invalid STATE number". State codes are standard codes as defined at [https://www2.census.gov/geo/docs/reference/state.txt]

Ideally the user would be selecting the state from a menu of options as the state numbers are not common knowledge.

If there are no accidents to plot, it will return null and no map is plotted.

@param state.num An integer representing the state identifier.
@param year An integer of the year to reference for mapping.

@return A map plot showing accidents in the state within the year.

@importFrom dplyr filter
@importFrom maps map
@importFrom graphics points

#### Examples

```{r echo = TRUE}

fars_map_state(6, 2015)

```


## Private Functions

Private functions called from the above

* fars_read
* make_filename
* fars_read_years




